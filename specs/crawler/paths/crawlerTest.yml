post:
  operationId: testUrl
  summary: Test an URL against the crawler's config.
  description: |-
    Test an URL against the given Crawler's config and see what will be processed.
    You can also override parts of the configuration to try your changes before updating the configuration.
  parameters:
    - $ref: '../common/parameters.yml#/CrawlerIdParameter'
  requestBody:
    content:
      application/json:
        schema:
          type: object
          properties:
            url:
              type: string
              description: The URL to test.
              example: https://www.algolia.com/blog
            config:
              type: object
              description: |-
                A partial configuration object, that will be merged with the configuration saved.
                This allows to tests changes in a configuration before saving it.
                Note that it's not a deep merge, we will simply override all top level fields with the ones that
                you will pass.
          required:
            - url
  responses:
    '200':
      description: Several information to know how the Crawler processed the given URL.
      content:
        application/json:
          schema:
            type: object
            properties:
              startDate:
                type: string
                description: The datetime when the test started.
                example: '2019-05-21T09:04:33.742Z'
              endDate:
                type: string
                description: The datetime when the test ended.
                example: '2019-05-21T09:04:33.923Z'
              logs:
                type: array
                description: The list of logs generated by `console.log()` in the recordExtractors.
                items:
                  type: array
                  description: Each console.log() accepts many parameter. They will be returned in an array.
                  items:
                    type: string
                    example: Processing url 'https://www.algolia.com/blog'
              records:
                type: array
                description: The list of records generated for the given URL.
                items:
                  type: object
                  properties:
                    indexName:
                      type: string
                      description: The name of the targeted index.
                      example: testIndex
                    records:
                      type: array
                      description: The list of records generated by each action.
                      items:
                        type: object
                        description: An actual Algolia record.
                        example:
                          objectID: 'https://www.algolia.com/blog'
                          numberOfLinks: 2
                    recordsPerExtractor:
                      type: array
                      description: The record's parts generated by each extractor.
                      items:
                        type: object
                        properties:
                          index:
                            type: number
                            description: Index of the extractor.
                          type:
                            type: string
                            description: Type of the extractor.
                          records:
                            type: array
                            items:
                              type: object
                              description: The partial record generated by the extractor.
                      example:
                        - index: 0
                          type: 'custom'
                          records:
                            - objectID: 'https://www.algolia.com/blog'
                              
              links:
                type: array
                description: The list of links found on the page, that match the configuration (and would be processed).
                items:
                  type: string
                example:
                  - https://blog.algolia.com/challenging-migration-heroku-google-kubernetes-engine/
                  - https://blog.algolia.com/tale-two-engines-algolia-unity/
              externalData:
                type: object
                description: The External Data associated to the tested URL. External data are refreshed automatically before reindex.
                example:
                  externalData1: {data1: 'val1', data2: 'val2'}
                  externalData2: {data1: 'val1', data2: 'val2'}
              error:
                type: object
                properties:
                  code:
                    type: string
                    example: http_internal_server_error
                  message:
                    type: string
                    example: HTTP Internal Server Error (500)
                example: {}
            required:
              - startDate
              - endDate
              - logs
              - records
              - links
    '400':
      $ref: '../../common/responses/InvalidRequest.yml'
    '401':
      $ref: '../common/schemas/responses.yml#/MissingAuthorization'
    '403':
      $ref: '../common/schemas/responses.yml#/NoRightsOnCrawler'
