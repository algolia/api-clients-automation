post:
  tags:
    - events
  operationId: pushEvents
  summary: Send events.
  description: |
    Send a list of events to the Insights API.

    You can include up to 1,000 events in a single request,
    but the request body must be smaller than 2MB.
  requestBody:
    required: true
    content:
      application/json:
        schema:
          title: InsightsEvents
          type: object
          additionalProperties: false
          required:
            - events
          properties:
            events:
              type: array
              description: |
                List of click and conversion events.

                An event is an object representing a user interaction.
                Events have attributes that describe the interaction,
                such as an event name, a type, or a user token.
                Some attributes require other attributes to be declared,
                and some attributes can't be declared at the same time.

                **All** events must be valid or the API returns an error.
              minItems: 1
              maxItems: 1000
              items:
                title: InsightsEvent
                description: Click and conversion event.
                type: object
                additionalProperties: false
                minItems: 1
                maxItems: 1000
                properties:
                  eventType:
                    $ref: '../common/enums.yml#/eventType'
                  eventName:
                    type: string
                    minLength: 1
                    maxLength: 64
                    description: |
                      Can contain up to 64 ASCII characters. 

                      Consider naming events consistentlyâ€”for example,
                      by adopting Segment's
                      [object-action](https://segment.com/academy/collecting-data/naming-conventions-for-clean-data/#the-object-action-framework)
                      framework.
                    example: Product Clicked
                  index:
                    type: string
                    description: Name of the Algolia index.
                    example: YourIndexName
                  userToken:
                    type: string
                    minLength: 1
                    maxLength: 128
                    pattern: '[a-zA-Z0-9_=/+-]{1,128}'
                    description: |
                      Anonymous or pseudonymous user identifier. 

                      > **Note**: Never include personally identifiable information in user tokens.
                    example: test-user-1
                  timestamp:
                    type: integer
                    format: int64
                    description: |
                      Time of the event in milliseconds in [Unix epoch time](https://en.wikipedia.org/wiki/Unix_time).
                      By default, the Insights API uses the time it receives an event as its timestamp.
                    example: 1687193127
                  queryID:
                    type: string
                    pattern: '[0-9a-f]{32}'
                    minLength: 32
                    maxLength: 32
                    description: |
                      Unique identifier for a search query.

                      The query ID is required for events related to search or browse requests.
                      If you add `clickAnalytics: true` as a search request parameter, the query ID is included in the API response.
                    example: 3e48cd0616e466948dd85abf5c3fbbe2
                  objectIDs:
                    type: array
                    description: List of object identifiers for items of an Algolia index.
                    items:
                      type: string
                    minItems: 1
                    maxItems: 20
                    example: ['object-1', 'object-2', 'object-3']
                  filters:
                    type: array
                    description: |
                      List of facet filters.

                      Each facet filter string must be URL-encoded, such as, `discount:10%25`.
                    items:
                      type: string
                    minItems: 1
                    maxItems: 20
                    example: ['brand:apple']
                  positions:
                    type: array
                    items:
                      type: integer
                    minimum: 1
                    minItems: 1
                    maxItems: 20
                    description: |
                      Position of the clicked objects in the search results.

                      The first search result has a position of 1 (not 0).
                      You must provide 1 `position` for each `objectID`.
                    example: [1, 2, 5]
                required:
                  - eventName
                  - eventType
                  - index
                  - userToken
        examples:
          ClickObjectIDsAfterSearch:
            summary: Click event after search requests.
            value:
              'events':
                - 'eventName': 'Products Clicked'
                  'eventType': 'click'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
                  'positions': [1]
                  'queryID': '7dfe2ada7bca48bdd0629649df0bee07'          
          ConversionObjectIDsAfterSearch:
            summary: Conversion event after search requests.
            value:
              'events':
                - 'eventName': 'Products Purchased'
                  'eventType': 'conversion'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
                  'queryID': '7dfe2ada7bca48bdd0629649df0bee07'
          ClickObjectIDs:
            summary: Click event unrelated to search requests.
            value:
              'events':
                - 'eventName': 'Products Clicked'
                  'eventType': 'click'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
          ConversionObjectIDs:
            summary: Conversion event unrelated to search requests.
            value:
              'events':
                - 'eventName': 'Products Added To Cart'
                  'eventType': 'conversion'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
          ClickFilter:
            summary: Click event with filters.
            value:
              'events':
                - 'eventName': 'Category Clicked'
                  'eventType': 'click'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'filters': ['category:books']
          ConversionFilter:
            summary: Conversion event with filters.
            value:
              'events':
                - 'eventName': 'Category Converted'
                  'eventType': 'conversion'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'filters': ['category:books']     
          ViewEventExample:
            summary: View event.
            value:
              'events':
                - 'eventName': 'Viewed Products'
                  'eventType': 'view'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
          ViewFiltersExample:
            summary: View event with filters.
            value:
              'events':
                - 'eventName': 'Viewed Category'
                  'eventType': 'view'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'filters': ['category:books']
          MultipleEvents:
            summary: Multiple events.
            value:
              'events': 
                - 'eventName': 'Viewed Products'
                  'eventType': 'view'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['objectID-1']
                  
                - 'eventName': 'ClickedProduct'
                  'eventType': 'click'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'queryID': '7dfe2ada7bca48bdd0629649df0bee07'
                  'objectIDs': ['objectID-1']
                  'positions': [1]
                  
                - 'eventName': 'Product Added To Cart'
                  'eventType': 'conversion'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'queryID': '7dfe2ada7bca48bdd0629649df0bee07'
                  'objectIDs': ['objectID-1']
                  
  responses:
    '200':
      description: OK
      content:
        application/json:
          schema:
            $ref: '../common/schemas/EventsResponse.yml'
          examples:
            Success:
              summary: Events successfully sent to the Insights API.
              description: >-
                Success indicates that the Insights API received the events correctly,
                and that event properties are formatted correctly.
                Success doesn't imply that the event can be used by any Algolia feature.
                For example, the Insights API doesn't check if the index name you provided exists,
                or if the object IDs exist in your index.
              value: {'status': 200, 'message': 'OK'}
    '400':
      description: Bad Request.
      content:
        text/html:
          schema:
            type: string
            title: HTML
          examples:
            BadRequest:
              summary: Bad request.
              description: This error doesn't return a JSON object, but HTML.
              value: 'Error: Bad Request. Your client has issued a malformed or illegal request.'
    '401':
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '../common/schemas/EventsResponse.yml'
          examples:
            Unauthorized:
              summary: Invalid credentials.
              description: You need to provide your application ID using the `X-Algolia-Application-ID` header and your (search) API key with the `X-Algolia-API-Key` header.
              value: {'status': 401, 'message': 'Invalid credentials'}
    '404':
      description: Not Found.
      content:
        application/json:
          schema:
            $ref: '../common/schemas/EventsResponse.yml'
          examples:
            NotFound:
              summary: Unsupported operation.
              description: Check that you're using the correct URL.
              value: {'status': 404, 'message': 'Path not supported by Insights REST API. Please have a look at [https://www.algolia.com/doc/rest-api/insights/](https://www.algolia.com/doc/rest-api/insights/) for the list of valid commands.'}
    '405':
      description: Method Not Allowed.
      content:
        application/json:
          schema:
            $ref: '../common/schemas/EventsResponse.yml'
          examples:
            MethodNotAllowed:
              summary: Method not allowed.
              description: Check, that you're using the `POST` method with the Insights API. Other methods aren't supported.
              value: {'status': 405, 'message': 'Method Not Allowed'}
    '413':
      description: Payload Too Large.
      content:
        application/json:
          schema:
            $ref: '../common/schemas/EventsResponse.yml'
          examples:
            PayloadTooLarge:
              summary: Request body larger than 2&nbsp;MB.
              value: {'status': 413, 'message': 'Request Entity Too Large'}
    '422':
      description: Unprocessable Entity.
      content:
        application/json:
          schema:
            $ref: '../common/schemas/EventsResponse.yml'
          examples:
            InvalidPayload:
              summary: Incorrect event object.
              value: {'status': 422, 'message': 'Invalid payload'}
            NoEvents:
              summary: No events.
              description: >-
                This can happen if you're sending an empty `events` array,
                or if you try to send a single event object instead of the `events` array.
              value: {'status': 422, 'message': 'No events to process'}
            NoEventsField:
              summary: Missing events attribute.
              description: This can happen if you try to send an array of events directly instead of using the `events` attribute.
              value: {'status': 422, 'message': 'Invalid type for field : expected insights.PublicEventsBatch, got array'}
            EventNameRequired:
              summary: Missing eventName attribute.
              value: {'status': 422, 'message': 'EventName is required'}
            WrongEventName:
              summary: Event name too long or wrong characters
              value: {'status': 422, 'message': 'EventName must contain only visible ascii characters, and be between 1 and 64 characeters long'}
            EventTypeRequired:
              summary: Missing eventType attribute.
              value: {'status': 422, 'message': 'EventType is required'}
            WrongEventType:
              summary: Wrong event type.
              value: {'status': 422, 'message': 'EventType must be one of "click", "conversion" or "view"'}
            IndexRequired:
              summary: Missing index attribute.
              value: {'status': 422, 'message': 'The index field is required'}
            UserTokenRequired:
              summary: Missing userToken attribute.
              value: {'status': 422, 'message': 'The userToken field is required'}
            WrongUserToken:
              summary: Malformed user token.
              value: {'status': 422, 'message': 'UserToken must contain only alphanumeric, equal, plus, slash, hyphen, or underscore characters, and be between 1 and 128 characters long'}
            NoObjectIDsOrFilters:
              summary: Missing objectIDs or filters attribute.
              description: Each event must include either the `objectIDs` or `filters` attribute.
              value: {'status': 422, 'message': 'Event should specify either some ObjectIDs or some Filters'}
            BothDefined:
              summary: Both objectIDs and filters attributes defined.
              value: {'status': 422, 'message': 'Event should specify ObjectIDs or Filters, but not both'}
            PositionsOnWrongEventType:
              summary: Wrong combination of positions and eventType attributes.
              value: {'status': 422, 'message': 'Only event of type click should specify the positions attribute'}
            PositionsWithoutQueryID:
              summary: Positions attribute without queryID.
              description: Click events with the `positions` attribute require the `queryID` attribute.
              value: {'status': 422, 'message': 'Event of type click with positions should specify a queryID'}
            WrongPositionsValue:
              summary: Wrong value in positions array.
              description: Any value in the `positions` array must be greater than or equal to 1.
              value: {'status': 422, 'message': 'Event of type click may only have strictly positive positions'}
            WrongPositionsItems:
              summary: Wrong number of items in positions array.
              description: >-
                For click events with the `queryID` and `objectIDs` attributes,
                you must include the `positions` attribute with the same number of items as the `objectIDs` attribute.
              value: {'status': 422, 'message': 'Event of type click should have the same number of ObjectIDs and Positions'}
            WrongQueryID:
              summary: Malformed query ID.
              value: {'status': 422, 'message': 'Query ID must be a search query ID (32 characters hexadecimal string)'}
            InvalidDataType:
              summary: Wrong data type.
              description: >-
                This can happen if one or more of the attributes is a number instead of a string.
              value: {'status': 422, 'message': 'Invalid type for field events: expected string, got number'}
            TooManyEvents:
              summary: Too many events.
              description: You can include up to 1,000 events in a single API request.
              value: {'status': 422, 'message': 'Cannot process more than 1000 events in a batch'}
