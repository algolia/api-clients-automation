post:
  tags:
    - events
  operationId: pushEvents
  summary: Send events.
  description: |
    Send a list of events to the Insights API.

    You can include up to 1,000 events in a single request,
    but the request body must be smaller than 2MB.
  requestBody:
    required: true
    content:
      application/json:
        schema:
          title: InsightsEvents
          type: object
          additionalProperties: false
          required:
            - events
          properties:
            events:
              type: array
              description: |
                List of click and conversion events.

                An event is an object representing a user interaction.
                Events have attributes that describe the interaction,
                such as an event name, a type, or a user token.
                Some attributes require other attributes to be declared,
                and some attributes can't be declared at the same time.

                **All** events must be valid or the API returns an error.
              minItems: 1
              maxItems: 1000
              items:
                title: InsightsEvent
                description: Click and conversion event.
                type: object
                additionalProperties: false
                minItems: 1
                maxItems: 1000
                properties:
                  eventType:
                    $ref: '../common/enums.yml#/eventType'
                  eventName:
                    type: string
                    minLength: 1
                    maxLength: 64
                    description: |
                      Can contain up to 64 ASCII characters. 

                      Consider naming events consistentlyâ€”for example,
                      by adopting Segment's
                      [object-action](https://segment.com/academy/collecting-data/naming-conventions-for-clean-data/#the-object-action-framework)
                      framework.
                    example: Product Clicked
                  index:
                    type: string
                    description: Name of the Algolia index.
                    example: YourIndexName
                  userToken:
                    type: string
                    minLength: 1
                    maxLength: 128
                    pattern: '[a-zA-Z0-9_=/+-]{1,128}'
                    description: |
                      Anonymous or pseudonymous user identifier. 

                      > **Note**: Never include personally identifiable information in user tokens.
                    example: test-user-1
                  timestamp:
                    type: integer
                    format: int64
                    description: |
                      Time of the event in milliseconds in [Unix epoch time](https://en.wikipedia.org/wiki/Unix_time).
                      By default, the Insights API uses the time it receives an event as its timestamp.
                    example: 1687193127
                  queryID:
                    type: string
                    pattern: '[0-9a-f]{32}'
                    minLength: 32
                    maxLength: 32
                    description: |
                      Unique identifier for a search query.

                      The query ID is required for events related to search or browse requests.
                      If you add `clickAnalytics: true` as a search request parameter, the query ID is included in the API response.
                    example: 3e48cd0616e466948dd85abf5c3fbbe2
                  objectIDs:
                    type: array
                    description: List of object identifiers for items of an Algolia index.
                    items:
                      type: string
                    minItems: 1
                    maxItems: 20
                    example: ['object-1', 'object-2', 'object-3']
                  filters:
                    type: array
                    description: |
                      List of facet filters.

                      Each facet filter string must be URL-encoded, such as, `discount:10%25`.
                    items:
                      type: string
                    minItems: 1
                    maxItems: 20
                    example: ['brand:apple']
                  positions:
                    type: array
                    items:
                      type: integer
                    minimum: 1
                    minItems: 1
                    maxItems: 20
                    description: |
                      Position of the clicked objects in the search results.

                      The first search result has a position of 1 (not 0).
                      You must provide 1 `position` for each `objectID`.
                    example: [1, 2, 5]
                required:
                  - eventName
                  - eventType
                  - index
                  - userToken
        examples:
          ClickObjectIDsAfterSearch:
            summary: Click event after search requests
            value:
              'events':
                - 'eventName': 'Products Clicked'
                  'eventType': 'click'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
                  'positions': [1]
                  'queryID': '7dfe2ada7bca48bdd0629649df0bee07'          
          ConversionObjectIDsAfterSearch:
            summary: Conversion event after search requests
            value:
              'events':
                - 'eventName': 'Products Purchased'
                  'eventType': 'conversion'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
                  'queryID': '7dfe2ada7bca48bdd0629649df0bee07'
          ClickObjectIDs:
            summary: Click event unrelated to search requests
            value:
              'events':
                - 'eventName': 'Products Clicked'
                  'eventType': 'click'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
          ConversionObjectIDs:
            summary: Conversion event unrelated to search requests
            value:
              'events':
                - 'eventName': 'Products Added To Cart'
                  'eventType': 'conversion'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
          ClickFilter:
            summary: Click event with filters
            value:
              'events':
                - 'eventName': 'Category Clicked'
                  'eventType': 'click'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'filters': ['category:books']
          ConversionFilter:
            summary: Conversion event with filters
            value:
              'events':
                - 'eventName': 'Category Converted'
                  'eventType': 'conversion'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'filters': ['category:books']     
          ViewEventExample:
            summary: View event
            value:
              'events':
                - 'eventName': 'Viewed Products'
                  'eventType': 'view'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['object-1']
          ViewFiltersExample:
            summary: View event with filters
            value:
              'events':
                - 'eventName': 'Viewed Category'
                  'eventType': 'view'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'filters': ['category:books']
          MultipleEvents:
            summary: Multiple events
            value:
              'events': 
                - 'eventName': 'Viewed Products'
                  'eventType': 'view'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'objectIDs': ['objectID-1']
                  
                - 'eventName': 'ClickedProduct'
                  'eventType': 'click'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'queryID': '7dfe2ada7bca48bdd0629649df0bee07'
                  'objectIDs': ['objectID-1']
                  'positions': [1]
                  
                - 'eventName': 'Product Added To Cart'
                  'eventType': 'conversion'
                  'index': 'test-index'
                  'userToken': 'test-user-1'
                  'queryID': '7dfe2ada7bca48bdd0629649df0bee07'
                  'objectIDs': ['objectID-1']
                  
  responses:
    '200':
      description: OK
      content:
        application/json:
          schema:
            title: pushEventsResponse
            type: object
            additionalProperties: false
            required:
              - message
            properties:
              message:
                type: string
                description: A message confirming the event push.
    '400':
      $ref: '../../common/responses/BadRequest.yml'
    '401':
      $ref: '../../common/responses/Unauthorized.yml'
    '413':
      $ref: '../../common/responses/UnprocessableEntity.yml'
    '422':
      $ref: '../../common/responses/RequestEntityTooLarge.yml'
