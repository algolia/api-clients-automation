compositionBehavior:
  type: object
  additionalProperties: false
  properties:
    injection:
      title: injection
      type: object
      additionalProperties: false
      properties:
        main:
          title: main
          type: object
          additionalProperties: false
          properties:
            source:
              title: compositionSource
              type: object
              additionalProperties: false
              properties:
                search:
                  title: compositionSourceSearch
                  type: object
                  additionalProperties: false
                  properties:
                    index:
                      type: string
                      description: Composition Main Index name.
                      example: Products
                    params:
                      $ref: './Injection.yml#/mainInjectionQueryParameters'
                  required:
                    - index
              required:
                - search
          required:
            - source
        injectedItems:
          type: array
          description: list of injected items of the current Composition.
          minItems: 0
          maxItems: 2
          items:
            $ref: '#/injectedItem'
      required:
        - main
  required:
    - injection

injectedItem:
  type: object
  additionalProperties: false
  properties:
    key:
      type: string
      description: injected Item unique identifier.
    source:
      description: Search source to be used to inject items into result set.
      $ref: '#/injectedItemSource'
    position:
      type: integer
      minimum: 0
      maximum: 19
    length:
      type: integer
      minimum: 0
      maximum: 20
    metadata:
      title: injectedItemMetadata
      type: object
      description: Used to add metadata to the results of the injectedItem.
      properties:
        hits:
          title: injectedItemHitsMetadata
          type: object
          description: Adds the provided metadata to each injected hit via an `_extra` attribute.
          properties:
            addItemKey:
              type: boolean
              description: When true, the `_injectedItemKey` field is set in the `_extra` object of each affected hit.
            extra:
              type: object
              additionalProperties: true
              description: The user-defined key-value pairs that will be placed in the `_extra` field of each affected hit.
  required:
    - key
    - source
    - position
    - length

injectedItemSource:
  type: object
  additionalProperties: false
  properties:
    search:
      $ref: './InjectionSource.yml#/search'
    external:
      $ref: './InjectionSource.yml#/external'
  oneOf:
    - required: [search]
    - required: [external]
