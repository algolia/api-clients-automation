method:
  get:
    x-helper: true
    x-asynchronous-helper: false
    tags:
      - Api Keys
    x-available-languages:
      - csharp
      - go
      - java
      - javascript
      - kotlin
      - php
      - python
      - ruby
      - scala
      - swift
    x-acl: []
    operationId: generateSecuredApiKey
    summary: Create secured API keys
    description: |
      Generates a secured API key without any requests to Algolia's servers.

      Secured API keys are API keys that you generate on your server without any API request to Algolia.
      Use secured API keys when you can't update client-side code, such as in mobile apps,
      or when you need to restrict access to part of an index for each user.

      When users start searching, your app requests a short-lived secured API key from your server instead of using the Search API key.
      Your server uses this method to generate the secured API key with restrictions such as filters, index access restrictions,
      or expiration times, and returns it to your app. The API key gets longer as you add restrictions.

      You can't create secured API keys from other secured API keys or from your Admin API key.
      The generated API key can have the same restrictions as the parent API key, or be more restrictive.
    parameters:
      - in: query
        name: parentApiKey
        description: API key from which the secured API key will inherit its restrictions.
        required: true
        schema:
          type: string
      - in: query
        name: restrictions
        description: Restrictions to add to the API key.
        required: true
        schema:
          $ref: '#/securedApiKeyRestrictions'
    responses:
      '200':
        description: OK
        content:
          application/json:
            schema:
              type: string
      '400':
        $ref: '../../common/responses/IndexNotFound.yml'

securedApiKeyRestrictions:
  type: object
  additionalProperties: false
  properties:
    searchParams:
      $ref: '../../common/schemas/SearchParams.yml#/searchParamsObject'
    filters:
      type: string
      description: |
        Filters that apply to every search made with the secured API key.
        Extra filters added at search time will be combined with `AND`.
        For example, if you set `group:admin` as fixed filter on your generated API key,
        and add `groups:visitors` to the search query, the complete set of filters will be `group:admin AND groups:visitors`.
    validUntil:
      type: integer
      format: int64
      description: Timestamp when the secured API key expires, measured in seconds since the Unix epoch.
    restrictIndices:
      type: array
      items:
        type: string
      description: |
        Index names or patterns that this API key can access.
        By default, an API key can access all indices in the same application.

        You can use leading and trailing wildcard characters (`*`):

        - `dev_*` matches all indices starting with "dev_".
        - `*_dev` matches all indices ending with "_dev".
        - `*_products_*` matches all indices containing "_products_".
    restrictSources:
      type: string
      description: |
        IP network that are allowed to use this key.

        You can only add a single source, but you can provide a range of IP addresses.
        Use this to protect against API key leaking and reuse.
      example: '192.168.1.0/24'
    userToken:
      type: string
      description: |
        Pseudonymous user identifier to restrict usage of this API key to specific users.

        By default, rate limits are set based on IP addresses. This can be an issue if many users search from the same IP address.
        To avoid this, add a user token to each generated API key.
