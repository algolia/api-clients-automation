rule:
  type: object
  description: Rule object.
  additionalProperties: false
  properties:
    objectID:
      $ref: '../../../../common/parameters.yml#/objectID'
    conditions:
      type: array
      description: >
        [Conditions](https://www.algolia.com/doc/guides/managing-results/rules/rules-overview/#conditions) required to activate a rule. You can use up to 25 conditions per rule.
      items:
        $ref: '#/condition'
    consequence:
      $ref: '#/consequence'
    description:
      type: string
      description: A description of the rule's purpose. This can be helpful when searching for and presenting rules in, for example, the Algolia dashboard.
    enabled:
      type: boolean
      default: true
      description: If `true``, the rule is enabled. If it isn't enabled, it isn't applied at query time.
    validity:
      type: array
      description: If you specify a validity period, the rule _only_ applies only during that period. If specified, the array must not be empty.
      items:
        $ref: '#/timeRange'
  required:
    - objectID

condition:
  type: object
  additionalProperties: false
  properties:
    pattern:
      type: string
      description: Query pattern syntax.
    anchoring:
      $ref: '#/anchoring'
    alternatives:
      type: boolean
      description: Whether the pattern matches on plurals, synonyms, and typos.
      default: false
    context:
      type: string
      description: 'Rule context format: [A-Za-z0-9_-]+).'

anchoring:
  type: string
  description: Whether the pattern parameter matches the beginning (`startsWith`) or end (`endsWith`) of the query string, is an exact match (`is`), or a partial match (`contains`).
  enum: [is, startsWith, endsWith, contains]

consequence:
  type: object
  description: >
    [Consequences](https://www.algolia.com/doc/guides/managing-results/rules/rules-overview/#consequences) of a rule.
  additionalProperties: false
  properties:
    params:
      $ref: '#/consequenceParams'
    promote:
      type: array
      description: Objects to promote as hits.
      items:
        $ref: '#/promote'
    filterPromotes:
      type: boolean
      default: false
      description: Only use in combination with the promote consequence. When true, promoted results will be restricted to match the filters of the current search. When false, the promoted results will show up regardless of the filters.
    hide:
      type: array
      description: Objects to hide from hits. Each object must contain an objectID field. By default, you can hide up to 50 items per rule.
      items:
        title: consequenceHide
        type: object
        description: Unique identifier of the object to hide.
        additionalProperties: false
        properties:
          objectID:
            $ref: '../../../../common/parameters.yml#/objectID'
        required:
          - objectID
    userData:
      type: object
      description: Custom JSON object that will be appended to the userData array in the response. This object isn't interpreted by the API. It's limited to 1kB of minified JSON.

consequenceParams:
  allOf:
    - $ref: '../../../../common/schemas/SearchParams.yml#/baseSearchParamsWithoutQuery'
    - $ref: '../../../../common/schemas/IndexSettings.yml#/indexSettingsAsSearchParams'
    - $ref: '#/params'

promote:
  oneOf:
    - $ref: '#/promoteObjectIDs'
    - $ref: '#/promoteObjectID'

promoteObjectID:
  description: Single objectID to promote as hits.
  type: object
  additionalProperties: false
  properties:
    objectID:
      type: string
      description: Unique identifier of the object to promote.
    position:
      $ref: '#/promotePosition'
  required:
    - position
    - objectID

promoteObjectIDs:
  description: Multiple objectIDs to promote as hits.
  type: object
  additionalProperties: false
  properties:
    objectIDs:
      type: array
      description: Array of unique identifiers of the objects to promote.
      items:
        type: string
    position:
      $ref: '#/promotePosition'
  required:
    - position
    - objectIDs

promotePosition:
  type: integer
  description: The position to promote the objects to (zero-based). If you pass objectIDs, the objects are placed at this position as a group. For example, if you pass four objectIDs to position 0, the objects take the first four positions.

params:
  type: object
  description: Additional search parameters. Any valid search parameter is allowed.
  additionalProperties: false
  properties:
    query:
      $ref: '#/consequenceQuery'
    automaticFacetFilters:
      $ref: '#/automaticFacetFilters'
    automaticOptionalFacetFilters:
      $ref: '#/automaticOptionalFacetFilters'
    renderingContent:
      $ref: '../../../../common/schemas/IndexSettings.yml#/renderingContent'

consequenceQuery:
  description: When providing a string, it replaces the entire query string. When providing an object, it describes incremental edits to be made to the query string (but you can't do both).
  oneOf:
    - $ref: '#/consequenceQueryObject'
    - type: string

consequenceQueryObject:
  type: object
  additionalProperties: false
  properties:
    remove:
      description: Words to remove.
      type: array
      items:
        type: string
    edits:
      description: Edits to apply.
      type: array
      items:
        $ref: '#/edit'

edit:
  type: object
  additionalProperties: false
  properties:
    type:
      $ref: '#/editType'
    delete:
      description: Text or patterns to remove from the query string.
      type: string
    insert:
      description: Text that should be inserted in place of the removed text inside the query string.
      type: string

editType:
  description: Type of edit.
  type: string
  enum: [remove, replace]

automaticFacetFilters:
  description: Names of facets to which automatic filtering must be applied; they must match the facet name of a facet value placeholder in the query pattern.
  oneOf:
    - type: array
      items:
        $ref: '#/automaticFacetFilter'
    - type: array
      items:
        type: string

automaticOptionalFacetFilters:
  description: Same syntax as automaticFacetFilters, but the engine treats the filters as optional.
  $ref: '#/automaticFacetFilters'

automaticFacetFilter:
  type: object
  description: Automatic facet Filter.
  additionalProperties: false
  properties:
    facet:
      type: string
      description: Attribute to filter on. This must match a facet placeholder in the Rule's pattern.
    score:
      type: integer
      default: 1
      description: Score for the filter. Typically used for optional or disjunctive filters.
    disjunctive:
      type: boolean
      default: false
      description: Whether the filter is disjunctive (true) or conjunctive (false).
  required:
    - facet

timeRange:
  type: object
  additionalProperties: false
  properties:
    from:
      type: integer
      description: Lower bound of the time range (Unix timestamp).
    until:
      type: integer
      description: Upper bound of the time range (Unix timestamp).
  required:
    - from
    - until

updatedRuleResponse:
  type: object
  additionalProperties: false
  properties:
    objectID:
      $ref: '../../../../common/parameters.yml#/objectID'
    updatedAt:
      $ref: '../../../../common/responses/common.yml#/updatedAt'
    taskID:
      $ref: '../../../../common/responses/common.yml#/taskID'
  required:
    - objectID
    - updatedAt
    - taskID
