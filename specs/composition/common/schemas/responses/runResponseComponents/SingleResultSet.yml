# Schema for a single result set in a composition run response.
# {
#   "results": [
#     {
#       "hits": [
#         { ... },
#         { ... }
#       ],
#       "compositions": {
#         "comp1765458818347": {
#           "injectedItems": [
#             {
#               "key": "men-sponsored-group",
#               "appliedRules": [
#                 {
#                   "objectID": "qr-1765459001234"
#                 }
#               ],
#               "aiReRanking": {                               # Not described in the client
#                 "reRankingActivated": true,                  # at the moment
#                 "persoImpactInsideActivationWindow": false
#               }
#             }
#           ]
#         }
#       }
#     },
#    ...
#   ],
#   ...
# }

searchResultsItem:
  allOf:
    - $ref: '../../../../../common/schemas/SearchResponse.yml#/baseSearchResponse'
    - $ref: '#/SearchFields'
    - $ref: '#/resultsCompositionsResponse'

SearchFields:
  type: object
  additionalProperties: false
  properties:
    hits:
      $ref: '#/hits'
    hitsPerPage:
      $ref: '#/hitsPerPage'
    nbHits:
      $ref: '#/nbHits'
    nbPages:
      $ref: '#/nbPages'
    page:
      $ref: '#/page'
    params:
      $ref: '#/params'
    query:
      $ref: '#/query'

# ######################
# # Search Properties ##
# ######################

page:
  type: integer
  description: The current page of the results.
  example: 0

nbHits:
  type: integer
  description: Number of results (hits).
  example: 20

nbPages:
  type: integer
  description: Number of pages of results.
  example: 1

hitsPerPage:
  type: integer
  description: Number of hits returned per page.
  example: 20

hits:
  type: array
  description: |
    Search results (hits).

    Hits are records from your index that match the search criteria, augmented with additional attributes, such as, for highlighting.
  items:
    $ref: 'Hit.yml#/hit'
  
query:
  type: string
  description: The search query string.
  example: shoes

params:
  type: string
  description: URL-encoded string of all search parameters.
  example: query=a&hitsPerPage=20

# ############################
# # Composition Properties ##
# ###########################

resultsCompositionsResponse:
  type: object
  properties:
    compositions:
      additionalProperties:
        $ref: '#/resultsCompositionInfoResponse'        
  required:
    - compositions

resultsCompositionInfoResponse:
  type: object
  x-additionalPropertiesName: composition-id
  properties:
    injectedItems:
      type: array
      items:
        $ref: '#/resultsInjectedItemInfoResponse'
  required:
    - injectedItems

resultsInjectedItemInfoResponse:
  type: object
  additionalProperties: true
  properties:
    key:
      type: string
      description: The key of the injected group.
      example: 'men-sponsored-group'
    appliedRules:
      type: array
      items:
        $ref: '#/resultsInjectedItemAppliedRulesInfoResponse'
  required:
    - key

resultsInjectedItemAppliedRulesInfoResponse:
  type: object
  properties:
    objectID:
      type: string
      description: The objectID of the applied index level rule on this injected group.
  example:
    objectID: 'qr-1765458959657'
  required:
    - objectID