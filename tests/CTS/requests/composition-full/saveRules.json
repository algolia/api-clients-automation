[
  {
    "parameters": {
      "compositionID": "foo",
      "rules": {
        "requests": [
          {
            "action": "upsert",
            "body": {
              "objectID": "123",
              "conditions": [
                {
                  "pattern": "a"
                }
              ],
              "consequence": {
                "behavior": {
                  "injection": {
                    "main": {
                      "source": {
                        "search": {
                          "index": "<YOUR_INDEX_NAME>"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        ]
      }
    },
    "request": {
      "path": "/1/compositions/foo/rules/batch",
      "method": "POST",
      "body": {
        "requests": [
          {
            "action": "upsert",
            "body": {
              "objectID": "123",
              "conditions": [
                {
                  "pattern": "a"
                }
              ],
              "consequence": {
                "behavior": {
                  "injection": {
                    "main": {
                      "source": {
                        "search": {
                          "index": "<YOUR_INDEX_NAME>"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        ]
      }
    }
  },

  {
    "parameters": {
      "compositionID": "rule-with-metadata",
      "rules": {
        "requests": [
          {
            "action": "upsert",
            "body": {
              "objectID": "rule-with-metadata",
              "conditions": [
                {
                  "anchoring": "is",
                  "pattern": "test"
                }
              ],
              "consequence": {
                "behavior": {
                  "injection": {
                    "main": {
                      "source": {
                        "search": {
                          "index": "foo"
                        }
                      }
                    },
                    "injectedItems": [
                      {
                        "key": "injectedItem1",
                        "source": {
                          "search": {
                            "index": "foo",
                            "params": {
                              "filters": "brand:adidas"
                            }
                          }
                        },
                        "position": 2,
                        "length": 1,
                        "metadata": {
                          "hits": {
                            "addItemKey": true,
                            "extra": {
                              "my-string": "string",
                              "my-bool": true,
                              "my-number": 42,
                              "my-object": { "sub-key": "sub-value" },
                              "my-array": [1, 2, 3],
                              "my-empty-object": {}
                            }
                          }
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        ]
      }
    },
    "request": {
      "path": "/1/compositions/rule-with-metadata/rules/batch",
      "method": "POST",
      "body": {
        "requests": [
          {
            "action": "upsert",
            "body": {
              "objectID": "rule-with-metadata",
              "conditions": [
                {
                  "anchoring": "is",
                  "pattern": "test"
                }
              ],
              "consequence": {
                "behavior": {
                  "injection": {
                    "main": {
                      "source": {
                        "search": {
                          "index": "foo"
                        }
                      }
                    },
                    "injectedItems": [
                      {
                        "key": "injectedItem1",
                        "source": {
                          "search": {
                            "index": "foo",
                            "params": {
                              "filters": "brand:adidas"
                            }
                          }
                        },
                        "position": 2,
                        "length": 1,
                        "metadata": {
                          "hits": {
                            "addItemKey": true,
                            "extra": {
                              "my-string": "string",
                              "my-bool": true,
                              "my-number": 42,
                              "my-object": { "sub-key": "sub-value" },
                              "my-array": [1, 2, 3],
                              "my-empty-object": {}
                            }
                          }
                        }
                      }
                    ]
                  }
                }
              }
            }
          }
        ]
      }
    }
  },

  {
    "parameters": {
      "compositionID": "rule-with-exernal-source",
      "rules": {
        "requests": [
          {
            "action": "upsert",
            "body": {
              "objectID": "rule-with-exernal-source",
              "description": "my description",
              "tags": ["tag1", "tag2"],
              "enabled": true,
              "validity": [{ "from": 1704063600, "until": 1704083600 }],
              "conditions": [
                { "anchoring": "contains", "pattern": "harry" },
                { "anchoring": "contains", "pattern": "potter" }
              ],
              "consequence": {
                "behavior": {
                  "injection": {
                    "main": {
                      "source": {
                        "search": {
                          "index": "my-index",
                          "params": { "filters": "brand:adidas" }
                        }
                      }
                    },
                    "injectedItems": [
                      {
                        "key": "injectedItem",
                        "source": {
                          "external": {
                            "index": "my-index",
                            "params": { "filters": "brand:adidas" },
                            "ordering": "userDefined"
                          }
                        },
                        "position": 0,
                        "length": 3
                      }
                    ]
                  }
                }
              }
            }
          }
        ]
      }
    },
    "request": {
      "path": "/1/compositions/rule-with-exernal-source/rules/batch",
      "method": "POST",
      "body": {
        "requests": [
          {
            "action": "upsert",
            "body": {
              "objectID": "rule-with-exernal-source",
              "description": "my description",
              "tags": ["tag1", "tag2"],
              "enabled": true,
              "validity": [{ "from": 1704063600, "until": 1704083600 }],
              "conditions": [
                { "anchoring": "contains", "pattern": "harry" },
                { "anchoring": "contains", "pattern": "potter" }
              ],
              "consequence": {
                "behavior": {
                  "injection": {
                    "main": {
                      "source": {
                        "search": {
                          "index": "my-index",
                          "params": { "filters": "brand:adidas" }
                        }
                      }
                    },
                    "injectedItems": [
                      {
                        "key": "injectedItem",
                        "source": {
                          "external": {
                            "index": "my-index",
                            "params": { "filters": "brand:adidas" },
                            "ordering": "userDefined"
                          }
                        },
                        "position": 0,
                        "length": 3
                      }
                    ]
                  }
                }
              }
            }
          }
        ]
      }
    }
  }
]
