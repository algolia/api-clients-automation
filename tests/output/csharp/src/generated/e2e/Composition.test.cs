// Code generated by OpenAPI Generator (https://openapi-generator.tech), manual changes will be lost - read more on https://github.com/algolia/api-clients-automation. DO NOT EDIT.
using System.Text.Json;
using Algolia.Search.Clients;
using Algolia.Search.Http;
using Algolia.Search.Models.Composition;
using Algolia.Search.Serializer;
using Algolia.Search.Tests.Utils;
using dotenv.net;
using Quibble.Xunit;
using Xunit;
using Action = Algolia.Search.Models.Composition.Action;

namespace Algolia.Search.e2e;

public class CompositionClientRequestTestsE2E
{
  private readonly CompositionClient client;

  public CompositionClientRequestTestsE2E()
  {
    DotEnv.Load(
      options: new DotEnvOptions(
        ignoreExceptions: true,
        probeForEnv: true,
        probeLevelsToSearch: 8,
        envFilePaths: new[] { ".env" }
      )
    );

    var appId = Environment.GetEnvironmentVariable("METIS_APPLICATION_ID");
    if (appId == null)
    {
      throw new Exception("please provide an `METIS_APPLICATION_ID` env var for e2e tests");
    }

    var apiKey = Environment.GetEnvironmentVariable("METIS_API_KEY");
    if (apiKey == null)
    {
      throw new Exception("please provide an `METIS_API_KEY` env var for e2e tests");
    }

    client = new CompositionClient(new CompositionConfig(appId, apiKey));
  }

  [Fact]
  public void Dispose() { }

  [Fact(DisplayName = "listCompositions")]
  public async Task ListCompositionsTest1()
  {
    try
    {
      var resp = await client.ListCompositionsAsync();
      // Check status code 200
      Assert.NotNull(resp);

      JsonAssert.EqualOverrideDefault(
        "{\"items\":[{\"objectID\":\"id1\",\"name\":\"my first composition\",\"description\":\"the first ever composition from the client\",\"behavior\":{\"injection\":{\"main\":{\"source\":{\"search\":{\"index\":\"cts_e2e_small\"}}}}}}],\"nbPages\":1}",
        JsonSerializer.Serialize(resp, JsonConfig.Options),
        new JsonDiffConfig(true)
      );
    }
    catch (Exception e)
    {
      Assert.Fail("An exception was thrown: " + e.Message);
    }
  }
}
