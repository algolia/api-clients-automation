// Code generated by OpenAPI Generator (https://openapi-generator.tech), manual changes will be lost
// - read more on https://github.com/algolia/api-clients-automation. DO NOT EDIT.
package com.algolia.e2e

import com.algolia.client.api.CompositionClient
import com.algolia.client.configuration.*
import com.algolia.client.model.composition.*
import com.algolia.client.transport.*
import com.algolia.utils.*
import io.github.cdimascio.dotenv.Dotenv
import io.ktor.http.*
import kotlin.test.*
import kotlinx.coroutines.test.*
import kotlinx.serialization.encodeToString
import kotlinx.serialization.json.*
import org.skyscreamer.jsonassert.JSONAssert
import org.skyscreamer.jsonassert.JSONCompareMode

class CompositionTest {

  var client: CompositionClient

  init {
    if (System.getenv("CI") == "true") {
      this.client =
        CompositionClient(
          appId = System.getenv("METIS_APPLICATION_ID"),
          apiKey = System.getenv("METIS_API_KEY"),
        )
    } else {
      val dotenv = Dotenv.configure().directory("../../").load()
      this.client =
        CompositionClient(appId = dotenv["METIS_APPLICATION_ID"], apiKey = dotenv["METIS_API_KEY"])
    }
  }

  @Test
  fun `listCompositions1`() = runTest {
    client.runTest(
      call = { listCompositions() },
      response = {
        JSONAssert.assertEquals(
          "{\"items\":[{\"objectID\":\"id1\",\"name\":\"my first composition\",\"description\":\"the first ever composition from the client\",\"behavior\":{\"injection\":{\"main\":{\"source\":{\"search\":{\"index\":\"cts_e2e_small\"}}}}}}],\"nbPages\":1}",
          Json.encodeToString(it),
          JSONCompareMode.LENIENT,
        )
      },
    )
  }
}
