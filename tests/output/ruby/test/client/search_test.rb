# Code generated by OpenAPI Generator (https://openapi-generator.tech), manual changes will be lost - read more on https://github.com/algolia/api-clients-automation. DO NOT EDIT.
require 'algolia'
require 'test/unit'

class TestClientSearchClient < Test::Unit::TestCase
  include Algolia::Search
  # calls api with correct read host
  def test_api0
    client = Algolia::SearchClient.create(
      'test-app-id',
      'test-api-key',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    req = client.custom_get_with_http_info("test")
    assert_equal('test-app-id-dsn.algolia.net', req.host.url)
  end

  # calls api with correct write host
  def test_api1
    client = Algolia::SearchClient.create(
      'test-app-id',
      'test-api-key',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    req = client.custom_post_with_http_info("test")
    assert_equal('test-app-id.algolia.net', req.host.url)
  end

  # tests the retry strategy
  def test_api2
    client = Algolia::SearchClient.create_with_config(
      Algolia::Configuration.new(
        'test-app-id',
        'test-api-key',
        [
          Algolia::Transport::StatefulHost.new(
            'localhost',
            protocol: 'http://',
            port: 6677,
            accept: CallType::READ | CallType::WRITE
          ),
          Algolia::Transport::StatefulHost.new(
            'localhost',
            protocol: 'http://',
            port: 6678,
            accept: CallType::READ | CallType::WRITE
          )
        ],
        'searchClient'
      )
    )
    req = client.custom_get("1/test/retry")
    assert_equal({ 'message': "ok test server response" }, req)
  end

  # test the compression strategy
  def test_api3
    client = Algolia::SearchClient.create_with_config(
      Algolia::Configuration.new(
        'test-app-id',
        'test-api-key',
        [Algolia::Transport::StatefulHost.new(
          'localhost',
          protocol: 'http://',
          port: 6678,
          accept: CallType::READ | CallType::WRITE
        )],
        'searchClient',
        compression_type: 'gzip'
      )
    )
    req = client.custom_post(
      "1/test/gzip",
      {},
      { message: "this is a compressed body" }
    )
    assert_equal(
      { 'message': "ok compression test server response",
        'body': { 'message': "this is a compressed body" }},
      req
    )
  end

  # calls api with correct user agent
  def test_common_api0
    client = Algolia::SearchClient.create(
      'APP_ID',
      'API_KEY',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    req = client.custom_post_with_http_info("1/test")
    assert(req.headers['user-agent'].match(/^Algolia for Ruby \(\d+\.\d+\.\d+(-?.*)?\)(; [a-zA-Z. ]+ (\(\d+((\.\d+)?\.\d+)?(-?.*)?\))?)*(; Search (\(\d+\.\d+\.\d+(-?.*)?\)))(; [a-zA-Z. ]+ (\(\d+((\.\d+)?\.\d+)?(-?.*)?\))?)*$/))
  end

  # calls api with default read timeouts
  def test_common_api1
    client = Algolia::SearchClient.create(
      'APP_ID',
      'API_KEY',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    req = client.custom_get_with_http_info("1/test")
    assert_equal(2000, req.connect_timeout)
    assert_equal(5000, req.timeout)
  end

  # calls api with default write timeouts
  def test_common_api2
    client = Algolia::SearchClient.create(
      'APP_ID',
      'API_KEY',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    req = client.custom_post_with_http_info("1/test")
    assert_equal(2000, req.connect_timeout)
    assert_equal(30_000, req.timeout)
  end

  # generate secured api key basic
  def test_helpers0
    client = Algolia::SearchClient.create(
      'APP_ID',
      'API_KEY',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    req = client.generate_secured_api_key(
      "2640659426d5107b6e47d75db9cbaef8",
      SecuredApiKeyRestrictions.new(valid_until: 2_524_604_400, restrict_indices: ["Movies"])
    )
    assert_equal(
      'NjFhZmE0OGEyMTI3OThiODc0OTlkOGM0YjcxYzljY2M2NmU2NDE5ZWY0NDZjMWJhNjA2NzBkMjAwOTI2YWQyZnJlc3RyaWN0SW5kaWNlcz1Nb3ZpZXMmdmFsaWRVbnRpbD0yNTI0NjA0NDAw', req
    )
  end

  # generate secured api key with searchParams
  def test_helpers1
    client = Algolia::SearchClient.create(
      'APP_ID',
      'API_KEY',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    req = client.generate_secured_api_key(
      "2640659426d5107b6e47d75db9cbaef8",
      SecuredApiKeyRestrictions.new(
        valid_until: 2_524_604_400,
        restrict_indices: ["Movies", "cts_e2e_settings"],
        restrict_sources: "192.168.1.0/24",
        filters: "category:Book OR category:Ebook AND _tags:published",
        user_token: "user123",
        search_params: SearchParamsObject.new(
          query: "batman",
          typo_tolerance: 'strict',
          around_radius: 'all',
          mode: 'neuralSearch',
          hits_per_page: 10,
          optional_words: ["one", "two"]
        )
      )
    )
    assert_equal(
      'MzAxMDUwYjYyODMxODQ3ZWM1ZDYzNTkxZmNjNDg2OGZjMjAzYjQyOTZhMGQ1NDJhMDFiNGMzYTYzODRhNmMxZWFyb3VuZFJhZGl1cz1hbGwmZmlsdGVycz1jYXRlZ29yeSUzQUJvb2slMjBPUiUyMGNhdGVnb3J5JTNBRWJvb2slMjBBTkQlMjBfdGFncyUzQXB1Ymxpc2hlZCZoaXRzUGVyUGFnZT0xMCZtb2RlPW5ldXJhbFNlYXJjaCZvcHRpb25hbFdvcmRzPW9uZSUyQ3R3byZxdWVyeT1iYXRtYW4mcmVzdHJpY3RJbmRpY2VzPU1vdmllcyUyQ2N0c19lMmVfc2V0dGluZ3MmcmVzdHJpY3RTb3VyY2VzPTE5Mi4xNjguMS4wJTJGMjQmdHlwb1RvbGVyYW5jZT1zdHJpY3QmdXNlclRva2VuPXVzZXIxMjMmdmFsaWRVbnRpbD0yNTI0NjA0NDAw', req
    )
  end

  # client throws with invalid parameters
  def test_parameters0
    begin
      Algolia::SearchClient.create(
        '',
        '',
        { requester: Algolia::Transport::EchoRequester.new }
      )
      assert(false, 'An error should have been raised')
    rescue => e
      assert_equal('`app_id` is missing.', e.message)
    end
    begin
      Algolia::SearchClient.create(
        '',
        'my-api-key',
        { requester: Algolia::Transport::EchoRequester.new }
      )
      assert(false, 'An error should have been raised')
    rescue => e
      assert_equal('`app_id` is missing.', e.message)
    end
    begin
      Algolia::SearchClient.create(
        'my-app-id',
        '',
        { requester: Algolia::Transport::EchoRequester.new }
      )
      assert(false, 'An error should have been raised')
    rescue => e
      assert_equal('`api_key` is missing.', e.message)
    end
  end

  # `addApiKey` throws with invalid parameters
  def test_parameters1
    client = Algolia::SearchClient.create(
      'APP_ID',
      'API_KEY',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    begin
      client.add_api_key_with_http_info(nil)
      assert(false, 'An error should have been raised')
    rescue => e
      assert_equal('Parameter `api_key` is required when calling `add_api_key`.', e.message)
    end
  end

  # `addOrUpdateObject` throws with invalid parameters
  def test_parameters2
    client = Algolia::SearchClient.create(
      'APP_ID',
      'API_KEY',
      { requester: Algolia::Transport::EchoRequester.new }
    )
    begin
      client.add_or_update_object_with_http_info(nil, "my-object-id", {})
      assert(false, 'An error should have been raised')
    rescue => e
      assert_equal(
        'Parameter `index_name` is required when calling `add_or_update_object`.',
        e.message
      )
    end
    begin
      client.add_or_update_object_with_http_info("my-index-name", nil, {})
      assert(false, 'An error should have been raised')
    rescue => e
      assert_equal(
        'Parameter `object_id` is required when calling `add_or_update_object`.',
        e.message
      )
    end
    begin
      client.add_or_update_object_with_http_info("my-index-name", "my-object-id", nil)
      assert(false, 'An error should have been raised')
    rescue => e
      assert_equal('Parameter `body` is required when calling `add_or_update_object`.', e.message)
    end
  end
end
