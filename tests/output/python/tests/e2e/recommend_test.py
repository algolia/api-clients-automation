# Code generated by OpenAPI Generator (https://openapi-generator.tech), manual changes will be lost - read more on https://github.com/algolia/api-clients-automation. DO NOT EDIT.
from os import environ
from json import loads
from algoliasearch.recommend.client import RecommendClient
from algoliasearch.recommend.client import RecommendClientSync
from ..helpers import Helpers
from dotenv import load_dotenv

load_dotenv("../../.env")


class TestRecommendClientE2E:
    _helpers = Helpers()
    _e2e_app_id = environ.get("ALGOLIA_APPLICATION_ID")
    if _e2e_app_id is None:
        raise Exception(
            "please provide an `ALGOLIA_APPLICATION_ID` env var for e2e tests"
        )

    _e2e_api_key = environ.get("ALGOLIA_ADMIN_KEY")
    if _e2e_api_key is None:
        raise Exception("please provide an `ALGOLIA_ADMIN_KEY` env var for e2e tests")

    async def test_get_recommendations_1(self):
        """
        get recommendations with e2e to check oneOf model
        """
        raw_resp = await RecommendClient(
            self._e2e_app_id, self._e2e_api_key
        ).get_recommendations_with_http_info(
            get_recommendations_params={
                "requests": [
                    {
                        "indexName": "cts_e2e_browse",
                        "objectID": "Æon Flux",
                        "model": "related-products",
                        "threshold": 20.0,
                        "maxRecommendations": 2,
                    },
                ],
            },
        )
        assert raw_resp.status_code == 200

        resp = await RecommendClient(
            self._e2e_app_id, self._e2e_api_key
        ).get_recommendations(
            get_recommendations_params={
                "requests": [
                    {
                        "indexName": "cts_e2e_browse",
                        "objectID": "Æon Flux",
                        "model": "related-products",
                        "threshold": 20.0,
                        "maxRecommendations": 2,
                    },
                ],
            },
        )
        _expected_body = loads(
            """{"results":[{"exhaustive":{"nbHits":true,"typo":true},"exhaustiveNbHits":true,"exhaustiveTypo":true,"index":"cts_e2e_browse","page":0,"nbHits":2,"nbPages":1,"hitsPerPage":2,"hits":[{"objectID":"The Transformers: The Movie","_highlightResult":{"genres":[{"matchLevel":"none","matchedWords":[],"value":"Animated"},{"matchLevel":"none","matchedWords":[],"value":"Action"},{"matchLevel":"none","matchedWords":[],"value":"Science Fiction"}],"href":{"matchLevel":"none","matchedWords":[],"value":"The_Transformers:_The_Movie"}},"_score":100.0,"cast":["Judd Nelson","Leonard Nimoy","Robert Stack","Orson Welles","Michael Bell","Eric Idle","Chris Latta","Peter Cullen","Frank Welker","Neil Ross","Paul Eiding"],"extract":"The Transformers: The Movie is a 1986 animated science fiction action film based on the Transformers television series. It was released in North America on August 8, 1986, and in the United Kingdom on December 12, 1986. It was co-produced and directed by Nelson Shin, who also produced the television series. The screenplay was written by Ron Friedman, who created Bionic Six a year later.","title":"The Transformers: The Movie","year":1986},{"objectID":"Treasure Planet","_score":90.56,"title":"Treasure Planet","year":2002}]}]}"""
        )
        assert (
            self._helpers.union(_expected_body, self._helpers.unwrap(resp))
            == _expected_body
        )


class TestRecommendClientSyncE2E:
    _helpers = Helpers()
    _e2e_app_id = environ.get("ALGOLIA_APPLICATION_ID")
    if _e2e_app_id is None:
        raise Exception(
            "please provide an `ALGOLIA_APPLICATION_ID` env var for e2e tests"
        )

    _e2e_api_key = environ.get("ALGOLIA_ADMIN_KEY")
    if _e2e_api_key is None:
        raise Exception("please provide an `ALGOLIA_ADMIN_KEY` env var for e2e tests")

    def test_get_recommendations_1(self):
        """
        get recommendations with e2e to check oneOf model
        """
        raw_resp = RecommendClientSync(
            self._e2e_app_id, self._e2e_api_key
        ).get_recommendations_with_http_info(
            get_recommendations_params={
                "requests": [
                    {
                        "indexName": "cts_e2e_browse",
                        "objectID": "Æon Flux",
                        "model": "related-products",
                        "threshold": 20.0,
                        "maxRecommendations": 2,
                    },
                ],
            },
        )
        assert raw_resp.status_code == 200

        resp = RecommendClientSync(
            self._e2e_app_id, self._e2e_api_key
        ).get_recommendations(
            get_recommendations_params={
                "requests": [
                    {
                        "indexName": "cts_e2e_browse",
                        "objectID": "Æon Flux",
                        "model": "related-products",
                        "threshold": 20.0,
                        "maxRecommendations": 2,
                    },
                ],
            },
        )
        _expected_body = loads(
            """{"results":[{"exhaustive":{"nbHits":true,"typo":true},"exhaustiveNbHits":true,"exhaustiveTypo":true,"index":"cts_e2e_browse","page":0,"nbHits":2,"nbPages":1,"hitsPerPage":2,"hits":[{"objectID":"The Transformers: The Movie","_highlightResult":{"genres":[{"matchLevel":"none","matchedWords":[],"value":"Animated"},{"matchLevel":"none","matchedWords":[],"value":"Action"},{"matchLevel":"none","matchedWords":[],"value":"Science Fiction"}],"href":{"matchLevel":"none","matchedWords":[],"value":"The_Transformers:_The_Movie"}},"_score":100.0,"cast":["Judd Nelson","Leonard Nimoy","Robert Stack","Orson Welles","Michael Bell","Eric Idle","Chris Latta","Peter Cullen","Frank Welker","Neil Ross","Paul Eiding"],"extract":"The Transformers: The Movie is a 1986 animated science fiction action film based on the Transformers television series. It was released in North America on August 8, 1986, and in the United Kingdom on December 12, 1986. It was co-produced and directed by Nelson Shin, who also produced the television series. The screenplay was written by Ron Friedman, who created Bionic Six a year later.","title":"The Transformers: The Movie","year":1986},{"objectID":"Treasure Planet","_score":90.56,"title":"Treasure Planet","year":2002}]}]}"""
        )
        assert (
            self._helpers.union(_expected_body, self._helpers.unwrap(resp))
            == _expected_body
        )
