// Code generated by OpenAPI Generator (https://openapi-generator.tech), manual changes will be lost - read more on https://github.com/algolia/api-clients-automation. DO NOT EDIT.
import 'package:algolia_client_search/algolia_client_search.dart';
import 'package:algolia_test/algolia_test.dart';
import 'package:test/test.dart';
import 'package:test_api/hooks.dart';

void main() {
  test('calls api with correct read host', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
        appId: "test-app-id",
        apiKey: "test-api-key",
        options: ClientOptions(requester: requester));
    requester.setOnRequest((request) {
      expect(request.host.url, "test-app-id-dsn.algolia.net");
    });
    try {
      final res = await client.customGet(
        path: "test",
      );
    } on InterceptionException catch (_) {
      // Ignore InterceptionException
    }
  });

  test('read transporter with POST method', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
        appId: "test-app-id",
        apiKey: "test-api-key",
        options: ClientOptions(requester: requester));
    requester.setOnRequest((request) {
      expect(request.host.url, "test-app-id-dsn.algolia.net");
    });
    try {
      final res = await client.searchSingleIndex(
        indexName: "indexName",
      );
    } on InterceptionException catch (_) {
      // Ignore InterceptionException
    }
  });

  test('calls api with correct write host', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
        appId: "test-app-id",
        apiKey: "test-api-key",
        options: ClientOptions(requester: requester));
    requester.setOnRequest((request) {
      expect(request.host.url, "test-app-id.algolia.net");
    });
    try {
      final res = await client.customPost(
        path: "test",
      );
    } on InterceptionException catch (_) {
      // Ignore InterceptionException
    }
  });

  test('tests the retry strategy', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
        appId: "test-app-id",
        apiKey: "test-api-key",
        options: ClientOptions(hosts: [
          Host.create(url: 'localhost:6676', scheme: 'http'),
          Host.create(url: 'localhost:6677', scheme: 'http'),
          Host.create(url: 'localhost:6678', scheme: 'http'),
        ]));
    requester.setOnRequest((request) {});
    try {
      final res = await client.customGet(
        path: "1/test/retry/dart",
      );
      expectBody(res, """{"message":"ok test server response"}""");
    } on InterceptionException catch (_) {
      // Ignore InterceptionException
    }
  });

  test('tests the retry strategy error', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
        appId: "test-app-id",
        apiKey: "test-api-key",
        options: ClientOptions(hosts: [
          Host.create(url: 'localhost:6676', scheme: 'http'),
        ]));
    await expectError(
      'UnreachableHostsException{errors: [AlgoliaTimeoutException{error: DioException [receive timeout]: The request took longer than 0:00:05.000000 to receive data. It was aborted. To get rid of this exception, try raising the RequestOptions.receiveTimeout above the duration of 0:00:05.000000 or improve the response time of the server.}]}',
      () async {
        try {
          final res = await client.customGet(
            path: "1/test/hang/dart",
          );
        } on InterceptionException catch (_) {
          // Ignore InterceptionException
        }
      },
    );
  });

  test('calls api with correct user agent', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
      appId: 'appId',
      apiKey: 'apiKey',
      options: ClientOptions(requester: requester),
    );
    requester.setOnRequest((request) {
      TestHandle.current.markSkipped('User agent added using an interceptor');
    });
    try {
      final res = await client.customPost(
        path: "1/test",
      );
    } on InterceptionException catch (_) {
      // Ignore InterceptionException
    }
  });

  test('the user agent contains the latest version', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
      appId: 'appId',
      apiKey: 'apiKey',
      options: ClientOptions(requester: requester),
    );
    requester.setOnRequest((request) {
      TestHandle.current.markSkipped('User agent added using an interceptor');
    });
    try {
      final res = await client.customPost(
        path: "1/test",
      );
    } on InterceptionException catch (_) {
      // Ignore InterceptionException
    }
  });

  test('calls api with default read timeouts', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
      appId: 'appId',
      apiKey: 'apiKey',
      options: ClientOptions(requester: requester),
    );
    requester.setOnRequest((request) {
      expect(5000, request.timeout.inMilliseconds);
    });
    try {
      final res = await client.customGet(
        path: "1/test",
      );
    } on InterceptionException catch (_) {
      // Ignore InterceptionException
    }
  });

  test('calls api with default write timeouts', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
      appId: 'appId',
      apiKey: 'apiKey',
      options: ClientOptions(requester: requester),
    );
    requester.setOnRequest((request) {
      expect(30000, request.timeout.inMilliseconds);
    });
    try {
      final res = await client.customPost(
        path: "1/test",
      );
    } on InterceptionException catch (_) {
      // Ignore InterceptionException
    }
  });

  test('client throws with invalid parameters', () async {
    final requester = RequestInterceptor();
    await expectError(
      '`appId` is missing.',
      () async {
        final client = SearchClient(
            appId: "",
            apiKey: "",
            options: ClientOptions(requester: requester));
      },
    );
    await expectError(
      '`appId` is missing.',
      () async {
        final client = SearchClient(
            appId: "",
            apiKey: "my-api-key",
            options: ClientOptions(requester: requester));
      },
    );
    await expectError(
      '`apiKey` is missing.',
      () async {
        final client = SearchClient(
            appId: "my-app-id",
            apiKey: "",
            options: ClientOptions(requester: requester));
      },
    );
  });

  test('`addApiKey` throws with invalid parameters', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
      appId: 'appId',
      apiKey: 'apiKey',
      options: ClientOptions(requester: requester),
    );
    await expectError(
      'Parameter `apiKey` is required when calling `addApiKey`.',
      () async {
        try {
          final res = await client.addApiKey(
            apiKey: empty(),
          );
        } on InterceptionException catch (_) {
          // Ignore InterceptionException
        }
      },
    );
  });

  test('`addOrUpdateObject` throws with invalid parameters', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
      appId: 'appId',
      apiKey: 'apiKey',
      options: ClientOptions(requester: requester),
    );
    await expectError(
      'Parameter `indexName` is required when calling `addOrUpdateObject`.',
      () async {
        try {
          final res = await client.addOrUpdateObject(
            indexName: empty(),
            objectID: "my-object-id",
            body: {},
          );
        } on InterceptionException catch (_) {
          // Ignore InterceptionException
        }
      },
    );
    await expectError(
      'Parameter `objectID` is required when calling `addOrUpdateObject`.',
      () async {
        try {
          final res = await client.addOrUpdateObject(
            indexName: "my-index-name",
            objectID: empty(),
            body: {},
          );
        } on InterceptionException catch (_) {
          // Ignore InterceptionException
        }
      },
    );
    await expectError(
      'Parameter `body` is required when calling `addOrUpdateObject`.',
      () async {
        try {
          final res = await client.addOrUpdateObject(
            indexName: "my-index-name",
            objectID: "my-object-id",
            body: empty(),
          );
        } on InterceptionException catch (_) {
          // Ignore InterceptionException
        }
      },
    );
  });

  test('switch API key', () async {
    final requester = RequestInterceptor();
    final client = SearchClient(
        appId: "test-app-id",
        apiKey: "test-api-key",
        options: ClientOptions(hosts: [
          Host.create(url: 'localhost:6683', scheme: 'http'),
        ]));
    {
      requester.setOnRequest((request) {});
      try {
        final res = await client.customGet(
          path: "check-api-key/1",
        );
        expectBody(res, """{"headerAPIKeyValue":"test-api-key"}""");
      } on InterceptionException catch (_) {
        // Ignore InterceptionException
      }
    }
    {
      try {
        client.setClientApiKey(
          apiKey: "updated-api-key",
        );
      } on InterceptionException catch (_) {
        // Ignore InterceptionException
      }
    }
    {
      requester.setOnRequest((request) {});
      try {
        final res = await client.customGet(
          path: "check-api-key/2",
        );
        expectBody(res, """{"headerAPIKeyValue":"updated-api-key"}""");
      } on InterceptionException catch (_) {
        // Ignore InterceptionException
      }
    }
  });
}
