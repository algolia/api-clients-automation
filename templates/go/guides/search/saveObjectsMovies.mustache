package main

import (
  "encoding/json"
  "fmt"
  "net/http"
)

{{> snippets/import}}

func saveObjectsMovies() {
  // read json file
  url := "https://dashboard.algolia.com/sample_datasets/movie.json"
  response, err := http.Get(url)

  if err != nil {
    fmt.Println("Could not open url")
    return
  }

  defer response.Body.Close()

  // parse json file to Movie struct
  var movies []map[string]interface{}
  err = json.NewDecoder(response.Body).Decode(&movies)

  if err != nil {
    fmt.Println("Could not decode body")
    return
  }

	// initiate client
    {{> snippets/init}}

	// push data to algolia
	result, err := {{#dynamicSnippet}}saveObjectsMovies{{/dynamicSnippet}}
	if err != nil {
		fmt.Println(err)
		return
	}

fmt.Printf("Done! Uploaded records in %d batches.", len(result))
}