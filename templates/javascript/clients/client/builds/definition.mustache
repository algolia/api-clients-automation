import { createXhrRequester } from '@algolia/requester-browser-xhr';
import { createHttpRequester } from '@algolia/requester-node-http';
import { createFetchRequester } from '@algolia/requester-fetch';
import { createNullLogger, createMemoryCache, createFallbackableCache, createBrowserLocalStorageCache, createNullCache, serializeQueryParameters, DEFAULT_CONNECT_TIMEOUT_NODE, DEFAULT_READ_TIMEOUT_NODE, DEFAULT_WRITE_TIMEOUT_NODE, DEFAULT_CONNECT_TIMEOUT_BROWSER, DEFAULT_READ_TIMEOUT_BROWSER, DEFAULT_WRITE_TIMEOUT_BROWSER } from '@algolia/client-common';

import type { ClientOptions } from '@algolia/client-common';

import { create{{#lambda.titlecase}}{{clientName}}{{/lambda.titlecase}}, apiClientVersion } from '../src/{{clientName}}';

{{#hasRegionalHost}}
import { REGIONS } from '../src/{{clientName}}';
import type { Region, RegionOptions } from '../src/{{clientName}}'; 

export type { Region, RegionOptions } from '../src/{{clientName}}';
{{/hasRegionalHost}}

{{! We don't use `export *` to prevent exposing the factory, to avoid confusion for the user }}
export {
  apiClientVersion,
  {{#isIngestionClient}}
  isOnDemandTrigger,
  isScheduleTrigger,
  isSubscriptionTrigger,
  {{/isIngestionClient}}
} from '../src/{{clientName}}';

export * from '../model';

{{#isSearchClient}}
import type { GenerateSecuredApiKeyOptions, GetSecuredApiKeyRemainingValidityOptions, SearchClientNodeHelpers } from '../model';
{{/isSearchClient}}

{{#nodeSearchHelpers}}
import {createHmac} from 'node:crypto';
{{/nodeSearchHelpers}}

export function {{clientName}}(
  appId: string,
  apiKey: string,{{#hasRegionalHost}}region{{#fallbackToAliasHost}}?{{/fallbackToAliasHost}}: Region,{{/hasRegionalHost}}
  options?: ClientOptions
): {{#lambda.titlecase}}{{clientName}}{{/lambda.titlecase}} {
  if (!appId || typeof appId !== 'string') {
    throw new Error("`appId` is missing.");
  }
  
  if (!apiKey || typeof apiKey !== 'string') {
    throw new Error("`apiKey` is missing.");
  }
  
  {{#hasRegionalHost}}
    
  if ({{^fallbackToAliasHost}}!region || {{/fallbackToAliasHost}}(region && (typeof region !== 'string' || !REGIONS.includes(region)))) {
    throw new Error(`\`region\` {{^fallbackToAliasHost}}is required and {{/fallbackToAliasHost}}must be one of the following: ${REGIONS.join(', ')}`);
  }
  {{/hasRegionalHost}}